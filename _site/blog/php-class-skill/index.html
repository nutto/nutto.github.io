<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN" class="js">
<!--<![endif]-->
  

	

	
<head>
	<meta charset="utf-8">
	<title>【PHP拾遗】系列-类(class)-技巧 | Nutto的穿梭机</title>
	<meta name="description" content=", php, PHP的类有一些技巧,掌握他们可以让设计更加优雅而且提高工作效率.">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel='stylesheet' id='divi-style-css'  href="/css/style.css" type='text/css' media='all' />
	<link rel="stylesheet" href="/css/post.style.css">

	<script type='text/javascript' src="/js/jquery.js"></script>
	<script type='text/javascript' src="/js/soundmanager2-nodebug-jsmin.js"></script>

	<!--Favicon-->
	<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<link href="/favicon.ico" mce_href="favicon.ico" rel="bookmark" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="icon" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> 
	<!-- Canonical -->
	<link rel="canonical" href="http://blog.nuttopan.cn/blog/php-class-skill/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Nutto的穿梭机" href="http://blog.nuttopan.cn/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Inprove hightlight -->
	<link href="/css/syntax.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-76816542-1', 'auto');
	ga('send', 'pageview');
	</script>
	

	<script type="text/javascript">
    var host = "";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
    </script>
     <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-76816542-1', 'auto');
ga('send', 'pageview');

</script>
 
</head>

	<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
		<div id="page-container">
    		<header id="main-header" data-height-onload="66">
	<div class="container clearfix et_menu_container">
		<div class="logo_container">
			<span class="logo_helper"></span>
			<a href="/">
				<!--img src="http://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" /-->
				Nutto的穿梭机
			</a>
		</div>
		<div id="et-top-navigation" data-height="66" data-fixed-height="40">
			<nav id="top-menu-nav">
				<ul id="top-menu" class="nav">
					<li>
						<a class="page-link" href="/">
							Home
						</a>
					</li>
					
					
					
					
					<li>
						<a class="page-link" href="/About/">
							About
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/Archives/">
							Archive
						</a>
					</li>
					
					
					
					
					
					<li>
						<a class="page-link" href="/Daily/">
							日常
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<li>
						<a class="page-link" href="/Other/">
							其他
						</a>
					</li>
					
					
					
					
					
					<li>
						<a class="page-link" href="/Technology/">
							技术
						</a>
					</li>
					
					
					
					
					<!-- Social icons from Font Awesome, if enabled -->
					<li>
						<a class="page-link" href="">Find Me</a>
						<ul class="children">
<li>
	<a href="http://blog.nuttopan.cn/feed.xml" title="Follow RSS feed">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>













<li>
	<a href="https://github.com/nutto" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>

















<li>
	<a href="http://stackoverflow.com/users/4744833/nutto" title="Follow on Stack Exchange">
		<i class="fa fa-fw fa-stack-exchange"></i>
	</a>
</li>







<li>
	<a href="https://twitter.com/Nutto.pan" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="mailto:nutto.pan@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>
</ul>
					</li>
					
				</ul>
			</nav>

			<div id="et_mobile_nav_menu">
				<div class="mobile_nav closed">
					<span class="select_page"></span>
					<span class="mobile_menu_bar"></span>
				</div>
			</div>				
		</div> <!-- #et-top-navigation -->
	</div> <!-- .container -->
	<div class="et_search_outer">
		<div class="container et_search_form_container">
			<form role="search" method="get" class="et-search-form" action="http://blog.nuttopan.cn">
			<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" /></form>
			<span class="et_close_search_field"></span>
		</div>
	</div>
</header> <!-- #main-header -->

    		<div id="et-main-area">
      			

	

	

<article >
  <header style="background-image: url('/')">

<!--article  >
  <div style="background-image: url('/')"/>
  <header style="background-image: url('https://source.unsplash.com/category/nature/2600x500/daily')"-->
    <h1 class="title">【PHP拾遗】系列-类(class)-技巧</h1>
    <p id="subtitletrans" class="subtitlecontainer">
    <a class="subtitle">2016年05月7日</a>
     | <a class="subtitle" href="/About/">Nutto</a>
	 | <a class="subtitle"></a> <a class="subtitle">  <i class="fa fa-tag"></i>: <a href="/tags/php/">php</a></a>
    </p>
  </header>
  <section class="post-content">
  <p>PHP的类有一些技巧,掌握他们可以让设计更加优雅而且提高工作效率.</p>

<h2 id="section">对象序列化</h2>

<blockquote>
  <p>序列化： 将数据结构或对象转换成二进制串的过程
反序列化：将在序列化过程中所生成的二进制串转换成数据结构或者对象的过程</p>
</blockquote>

<p>在php中所有的值都可以使用函数 <code class="highlighter-rouge">serialize()</code> 来转换成一个包含字节流的字符串,这个过程就叫序列化.</p>

<p>通过函数 <code class="highlighter-rouge">unserialize()</code> 序列化后的字符串转换回php原来的值,这个过程叫反序列化.</p>

<p><strong>在PHP中要反序列化一个对象,这个对象的类必须在之前已经定义过.</strong>
我们举个例子:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$private</span> <span class="o">=</span> <span class="s1">'private'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$public</span> <span class="o">=</span> <span class="s1">'public'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$protected</span> <span class="o">=</span> <span class="s1">'protected'</span><span class="p">;</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showIntro</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'i am Nutto'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 序列化$a,获得字符串
</span><span class="nv">$serialized_a</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$serialized_a</span><span class="p">);</span>  <span class="c1">// output: O:1:"A":3:{s:10:"Aprivate";s:7:"private";s:6:"public";s:6:"public";s:12:"*protected";s:9:"protected";}
</span> 
<span class="c1">// 反序列化,获取对象
</span><span class="nv">$b</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized_a</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>  <span class="c1">// output: A Object ( [private:A:private] =&gt; private [public] =&gt; public [protected:protected] =&gt; protected )
</span></code></pre>
</div>

<p>对于序列化我们在PHP中比较常接触的例子就是SESSION的使用,当我们使用 <code class="highlighter-rouge">session_start()</code> 函数的时候,SESSION会在从会话数据存放的地方将数据抽出然后经过反序列化后存放在 <code class="highlighter-rouge">$_SESSION</code>超级全局变量中,而在每次会话结束的时候会将会话的数据序列化放到数据存放的地方.</p>

<h2 id="section-1">魔术方法</h2>

<p>PHP 将所有以 <code class="highlighter-rouge">__</code> (两个下划线)开头的类方法保留为魔术方法,所以在定义类方法时,除了上述魔术方法,建议不要以 <code class="highlighter-rouge">__</code> 为前缀.</p>

<p>魔术方法有例如:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">方法名</th>
      <th style="text-align: center">调用时机</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__construct()</code></td>
      <td style="text-align: center">对象构造时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__destruct()</code></td>
      <td style="text-align: center">对象析构时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__call()</code></td>
      <td style="text-align: center">调用对象不可访问的方法时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__callStatic()</code></td>
      <td style="text-align: center">用静态的方式调用对象不可访问的方法时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__get()</code></td>
      <td style="text-align: center">访问对象不可访问的属性时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__set()</code></td>
      <td style="text-align: center">设置对象不可访问的属性时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__isset()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">isset()</code> 检测不可访问的属性的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__unset()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">unset()</code> 移除不可访问的属性的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__sleep()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">serialize()</code> 序列化对象的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__wakeup()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">unserialize()</code> 反序列化对象的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__toString()</code></td>
      <td style="text-align: center">当对象当作字符串输出的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__invoke()</code></td>
      <td style="text-align: center">当对象当作函数调用的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__set_state()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">var_export()</code> 输出对象时调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__clone()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">clone</code> 复制对象的时候调用</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">__debugInfo()</code></td>
      <td style="text-align: center">使用 <code class="highlighter-rouge">var_dump()</code> 输出对象时调用</td>
    </tr>
  </tbody>
</table>

<p>其中有一些的魔术方法已经在<a href="http://blog.nuttopan.cn/blog/php-class-advance/">【PHP拾遗】系列-类(class)-进阶</a>有所涉及,现在我们就说一下一些没有涉及到的魔术方法.</p>

<h3 id="sleep--wakeup"><code class="highlighter-rouge">__sleep()</code> 和 <code class="highlighter-rouge">__wakeup()</code></h3>

<p>在序列化的时候, <code class="highlighter-rouge">__sleep()</code> 这个魔术方法会被调用,这个方法要返回一个包含对象中所有应被序列化的变量名称的数组,如果没有返回任何内容则会发生错误.</p>

<p>在反序列化的时候 <code class="highlighter-rouge">__wakeup()</code> 会被调用
举个例子:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$private</span> <span class="o">=</span> <span class="s1">'private'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$public</span> <span class="o">=</span> <span class="s1">'public'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$protected</span> <span class="o">=</span> <span class="s1">'protected'</span><span class="p">;</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showIntro</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'i am Nutto'</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__sleep</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"call __sleep</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">'private'</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__wakeup</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"call __wakeup</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 序列化会唤起__sleep()
</span><span class="nv">$serialized_a</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>  <span class="c1">// output: call __sleep
</span> 
<span class="c1">// 对象只序列化了__sleep()返回的属性列表对应的属性
</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$serialized_a</span><span class="p">);</span>  <span class="c1">// output: O:1:"A":1:{s:10:"Aprivate";s:7:"private";}
</span> 
<span class="c1">// 反序列化会唤起__wakeup()
</span><span class="nb">print_r</span><span class="p">(</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized_a</span><span class="p">));</span>  <span class="c1">// output: call __wakeup
</span></code></pre>
</div>

<h3 id="tostring"><code class="highlighter-rouge">__toString()</code></h3>

<p>当对象被当作字符串输出的时候就会唤起对象中的 <code class="highlighter-rouge">__toString()</code> 方法
比如:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">__METHOD__</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 当作字符串输出
</span><span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>  <span class="c1">// output: A::__toString
</span> 
<span class="c1">// 使用%s也是当作字符串输出
</span><span class="nb">printf</span><span class="p">(</span><span class="s2">"%s"</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>  <span class="c1">// output: A::__toString
</span> 
<span class="c1">// 使用%f当作浮点输出的时候就会出问题
</span><span class="nb">printf</span><span class="p">(</span><span class="s2">"%f"</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>  <span class="c1">// output: Notice: Object of class A could not be converted to float
</span></code></pre>
</div>

<h3 id="invoke"><code class="highlighter-rouge">__invoke()</code></h3>

<p>当对象被当作方法调用的时候, <code class="highlighter-rouge">__invoke()</code> 就会唤起
比如:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__invoke</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'invoke '</span> <span class="o">.</span> <span class="nx">__METHOD__</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 当对象被当作函数调用的时候__incoke会被唤起
</span><span class="nv">$a</span><span class="p">();</span>  <span class="c1">// output: invoke A::__invoke
</span></code></pre>
</div>

<h3 id="setstate"><code class="highlighter-rouge">__set_state()</code></h3>

<p><code class="highlighter-rouge">static object __set_state ( array $properties )</code></p>

<p>这个方法是一个静态方法,会传入一个参数是 <code class="highlighter-rouge">var_export()</code> 传入的第一个参数,对于对象来说就是 array(‘property’ =&gt; value, …) 格式排列的类属性</p>

<p>当调用 <code class="highlighter-rouge">var_export()</code> 输出对象的时候,该方法会被唤起</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$private</span> <span class="o">=</span> <span class="s1">'private'</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">__set_state</span><span class="p">(</span><span class="nv">$properties</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'invoke '</span> <span class="o">.</span> <span class="nx">__METHOD__</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$properties</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 当对象被当作函数调用的时候__incoke会被唤起
</span><span class="nb">var_export</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>  <span class="c1">// output: A::__set_state(array(
</span>                 <span class="c1">//    'private' =&gt; 'private',
</span>                 <span class="c1">// ))
</span></code></pre>
</div>

<h3 id="debuginfo"><code class="highlighter-rouge">__debugInfo()</code></h3>

<p>当对象被 <code class="highlighter-rouge">var_dump()</code> 调用的时候, <code class="highlighter-rouge">__dubugInfo()</code> 会被唤起.
比如:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__debugInfo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'degug '</span> <span class="o">.</span> <span class="nx">__METHOD__</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// 当对象被当作函数调用的时候__incoke会被唤起
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>  <span class="c1">// output: degug A::__debugInfo
</span>               <span class="c1">//   object(A)#1 (0) {
</span>               <span class="c1">// }
</span></code></pre>
</div>

<h3 id="clone"><code class="highlighter-rouge">__clone()</code></h3>

<p>当使用 <code class="highlighter-rouge">clone()</code> 进行对象复制的时候, <code class="highlighter-rouge">__clone()</code> 方法会被唤起.</p>

<p>当使用 <code class="highlighter-rouge">clone()</code> 进行对象复制的时候,执行的是一个浅复制,即是说如果对象中有引用属性的话,复制出来的对象的该属性也会引用到原来的对象.</p>

<p>辛好我们可以通过 <code class="highlighter-rouge">clone()</code> 唤起的 <code class="highlighter-rouge">__clone()</code>魔术方法,对引用属性进行进一步的复制.</p>

<p>比如:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SubObject</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="nv">$instances</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$instance</span><span class="p">;</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instance</span> <span class="o">=</span> <span class="o">++</span><span class="nx">self</span><span class="o">::</span><span class="nv">$instances</span><span class="p">;</span>
    <span class="p">}</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">instance</span> <span class="o">=</span> <span class="o">++</span><span class="nx">self</span><span class="o">::</span><span class="nv">$instances</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">MyCloneable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$object1</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$object2</span><span class="p">;</span>
 
    <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span>
    <span class="p">{</span>
 
        <span class="c1">// 强制复制一份this-&gt;object， 否则仍然指向同一个对象
</span>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">object1</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">object1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCloneable</span><span class="p">();</span>
 
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">object1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SubObject</span><span class="p">();</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">object2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SubObject</span><span class="p">();</span>
 
<span class="nv">$obj2</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$obj</span><span class="p">;</span>
 
 
<span class="k">print</span><span class="p">(</span><span class="s2">"Original Object:</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
<span class="cm">/*
output:
Original Object:
MyCloneable Object
(
    [object1] =&gt; SubObject Object
        (
            [instance] =&gt; 1
        )
 
    [object2] =&gt; SubObject Object
        (
            [instance] =&gt; 2
        )
 
)
*/</span>
 
<span class="k">print</span><span class="p">(</span><span class="s2">"Cloned Object:</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj2</span><span class="p">);</span>
<span class="cm">/*
output:
Cloned Object:
MyCloneable Object
(
    [object1] =&gt; SubObject Object
        (
            [instance] =&gt; 3
        )
 
    [object2] =&gt; SubObject Object
        (
            [instance] =&gt; 2
        )
 
)
*/</span>
</code></pre>
</div>

<h2 id="section-2">对象的比较</h2>

<ul>
  <li>当使用比较运算符 <code class="highlighter-rouge">==</code> 比较两个对象变量时,比较的原则是:如果两个对象的属性和属性值 都相等,而且两个对象是同一个类的实例,那么这两个对象变量相等.</li>
  <li>当使用全等运算符 <code class="highlighter-rouge">===</code> ,这两个对象变量一定要指向某个类的同一个实例(即同一个对象).</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$var</span><span class="p">;</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$var</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span> <span class="o">=</span> <span class="nv">$var</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">B</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$var</span><span class="p">;</span>
 
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$var</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span> <span class="o">=</span> <span class="nv">$var</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
<span class="nv">$shadow_a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
 
<span class="nv">$mock_a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
<span class="nv">$fake_a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">(</span><span class="s1">'b'</span><span class="p">);</span>
 
<span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">B</span><span class="p">(</span><span class="s1">'b'</span><span class="p">);</span>
<span class="nv">$fake_b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">B</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
 
<span class="c1">// 同类同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="nv">$mock_a</span><span class="p">);</span>  <span class="c1">// output: true
// 同类不同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="nv">$fake_a</span><span class="p">);</span>  <span class="c1">// output: false
// 不同类同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="nv">$fake_b</span><span class="p">);</span>  <span class="c1">// output: false
// 不同类不同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="nv">$b</span><span class="p">);</span>  <span class="c1">// output: false
</span> 
<span class="c1">// 同对象
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$shadow_a</span><span class="p">);</span>  <span class="c1">// output: true
// 同类同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$mock_a</span><span class="p">);</span>  <span class="c1">// output: false
// 同类不同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$fake_a</span><span class="p">);</span>  <span class="c1">// output: false
// 不同类同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$fake_b</span><span class="p">);</span>  <span class="c1">// output: false
// 不同类不同值
</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$b</span><span class="p">);</span>  <span class="c1">// output: false
</span></code></pre>
</div>

<h2 id="section-3">类型约束</h2>

<p>在PHP5+我们可以指定参数的类型来进行类型约束</p>

<p>类型可以指定为:</p>

<ul>
  <li>object name</li>
  <li>interface</li>
  <li>array</li>
  <li>callable</li>
</ul>

<p>如果默认值为 <code class="highlighter-rouge">null</code> 那么传入的实参也可以为 <code class="highlighter-rouge">null</code></p>

<p>如果一个类或接口指定了类型约束,则其所有的子类或实现也都如此.</p>

<p>举个例子:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span> <span class="p">{};</span>
 
<span class="k">function</span> <span class="nf">testClass</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a_obj</span><span class="p">)</span> <span class="p">{};</span>
 
<span class="k">function</span> <span class="nf">testArray</span><span class="p">(</span><span class="k">array</span> <span class="nv">$array</span><span class="p">)</span> <span class="p">{};</span>
 
<span class="k">function</span> <span class="nf">testInterface</span><span class="p">(</span><span class="nx">Traversable</span> <span class="nv">$iterator</span><span class="p">)</span> <span class="p">{};</span>
 
<span class="k">function</span> <span class="nf">testCallable</span><span class="p">(</span><span class="nx">callable</span> <span class="nv">$callabel</span><span class="p">)</span> <span class="p">{};</span>
 
<span class="k">function</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{};</span>
 
<span class="c1">// 正常调用
</span><span class="nx">testClass</span><span class="p">(</span><span class="k">new</span> <span class="nx">A</span><span class="p">());</span>  <span class="c1">// 传入一个A的对象
</span><span class="nx">testArray</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>  <span class="c1">// 传入数组
</span><span class="nx">testInterface</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">(</span><span class="k">array</span><span class="p">()));</span>  <span class="c1">// 传入可以遍历的对象
</span><span class="nx">testCallable</span><span class="p">(</span><span class="s1">'test'</span><span class="p">);</span>  <span class="c1">// 传入可调用函数的名字
</span> 
 
<span class="c1">// 非正常调用
</span><span class="nx">testClass</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">);</span>  <span class="c1">// output:  Fatal error:  Uncaught TypeError: Argument 1 passed to testClass() must be an instance of A
</span><span class="nx">testArray</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">);</span>  <span class="c1">// output: Fatal error:  Uncaught TypeError: Argument 1 passed to testArray() must be of the type array
</span><span class="nx">testInterface</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">);</span>  <span class="c1">// output: Fatal error: Uncaught TypeError: Argument 1 passed to testInterface() must implement interface Traversable
</span><span class="nx">testCallable</span><span class="p">(</span><span class="s1">'asdf'</span><span class="p">);</span>  <span class="c1">// output: Fatal error: Uncaught TypeError: Argument 1 passed to testCallable() must be callable
</span></code></pre>
</div>

<h2 id="section-4">对象遍历</h2>

<p>在PHP5+中,默认的时候遍历对象会遍历所有可见的属性</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$private</span> <span class="o">=</span> <span class="s1">'private'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$public</span> <span class="o">=</span> <span class="s1">'public'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$protected</span> <span class="o">=</span> <span class="s1">'protected'</span><span class="p">;</span>
<span class="p">};</span>
 
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
 
<span class="c1">// output: public =&gt; public
</span><span class="k">foreach</span> <span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"</span><span class="si">{</span><span class="nv">$key</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="nv">$value</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>我们也可以通过实现<strong>Iterator</strong>接口来决定遍历的方法,详情参考<a href="http://php.net/manual/zh/spl.iterators.php">SPL的迭代器</a></p>

  </section>
  
</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <a id="prev-post" href="/blog/php-class-advance/">
      <span class="page-title">【PHP拾遗】系列-类(class)-进阶</span>
      <span class="nav-label">
        <i class="fa fa-chevron-left"></i> 
      </span>
    </a>
    
    
</div>


<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//blognuttopancn.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


    		</div> <!-- #et-main-area -->
		</div> <!-- #page-container -->
		


<footer id="page-footer-trans" class="page-footer">
	<!--<p class="text"><a href="">Nutto的穿梭机</a> 
</p>-->
	Copyright &copy; 2016 <a href="">Nutto的穿梭机</a> 
 All Rights Reserved. 
	<p class="text">Powered by <a href="https://jekyllrb.com/">Jekyll</a>. Theme created by <a href="https://github.com/fengzhichu/fengzhichu-theme/tree/gh-pages">枫之楚</a>. Hosted in <a href="https://github.com">GitHub</a></p>
</footer>


    
<!-- WP Audio player plugin v1.9.3 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = '/plugins/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src="/js/frontend-builder-global-functions.js"></script>
<script type='text/javascript' src="/js/custom.js"></script>
<script type='text/javascript' src="/js/jquery.fitvids.js"></script>
<script type='text/javascript' src="/js/waypoints.min.js"></script>
<script type='text/javascript' src="/js/jquery.magnific-popup.js"></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"http:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"ae39988568","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src="/js/frontend-builder-scripts.js"></script>
  </body>
</html>
